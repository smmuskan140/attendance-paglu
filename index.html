<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Paglu</title>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Caveat:wght@400;700&family=Satisfy&family=Kalam:wght@300;400;700&family=Comfortaa:wght@300;400;700&family=Gochi+Hand&family=Courgette&family=Permanent+Marker&family=Covered+By+Your+Grace&family=Fredoka+One&family=Pacifico&family=Architects+Daughter&family=Amatic+SC:wght@400;700&family=Handlee&family=Nunito:wght@400;700&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar.closed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            font-size: 1.5em;
            font-weight: 700;
            color: #2e7d32;
            margin-bottom: 20px;
            padding: 12px;
            text-align: center;
        }

        .new-btn {
            background: #2e7d32;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            width: 100%;
            font-size: 0.9em;
        }

        .new-btn:hover {
            background: #1b5e20;
        }

        .nav-section {
            flex: 1;
        }

        .nav-section h4 {
            font-size: 0.7em;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            margin: 15px 0 8px 0;
            padding: 0 12px;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 4px 0;
            border-radius: 8px;
            cursor: pointer;
            color: #333;
            font-weight: 500;
            transition: all 0.2s;
            text-align: left;
            font-size: 0.9em;
        }

        .nav-item:hover {
            background: #f5f5f5;
            color: #2e7d32;
        }

        .nav-item.active {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 3px solid #2e7d32;
        }

        .sidebar-footer {
            border-top: 1px solid #e5e5e5;
            padding-top: 16px;
            text-align: center;
        }

        .sidebar-footer button {
            width: 100%;
            padding: 10px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            color: #333;
            font-size: 0.85em;
        }

        .sidebar-footer button:hover {
            background: #f5f5f5;
        }

        /* MAIN CONTENT */
        .main {
            flex: 1;
            margin-left: 260px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            transition: margin-left 0.3s ease;
        }

        .main.sidebar-closed {
            margin-left: 0;
        }

        /* HEADER */
        header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #333;
        }

        h1 {
            font-size: 1.5em;
            color: #2e7d32;
            font-weight: 700;
        }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; overflow-y: auto; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 40px; border-radius: 20px; max-width: 600px; width: 100%; margin: auto; }
        .modal h2 { margin-bottom: 20px; color: #333; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; }
        .button-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-modal { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #2e7d32; color: white; }
        .btn-secondary { background: #f0f0f0; color: #333; }

        /* DETAIL MODAL */
        .detail-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.6); 
            z-index: 2001; 
            justify-content: center; 
            align-items: center; 
            overflow-y: auto; 
            padding: 20px;
        }

        .detail-modal.show { display: flex; }

        .detail-content { 
            background: white; 
            width: 90%; 
            max-width: 900px; 
            border-radius: 20px; 
            padding: 0;
            margin: auto;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }

        .detail-header {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 30px;
            position: relative;
        }

        .detail-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .detail-header p {
            font-size: 1em;
            opacity: 0.9;
        }

        .close-btn { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            background: rgba(255,255,255,0.2);
            border: none; 
            font-size: 1.8em; 
            cursor: pointer; 
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .detail-body {
            padding: 40px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .detail-section {
            margin-bottom: 30px;
        }

        .detail-section h3 {
            color: #2e7d32;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
        }

        .detail-stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-stat {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .detail-stat label {
            display: block;
            color: #999;
            font-size: 0.85em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .detail-stat value {
            display: block;
            font-size: 2em;
            font-weight: 700;
            color: #2e7d32;
        }

        .detail-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .detail-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .detail-btn.secondary {
            background: #e8f5e9;
            color: #1b5e20;
        }

        .detail-btn.secondary:hover {
            background: #c8e6c9;
        }

        .detail-btn.danger {
            background: #ffebee;
            color: #c62828;
        }

        .detail-btn.danger:hover {
            background: #ffcdd2;
        }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; overflow-x: auto; }
        .tab-btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; background: white; color: #666; white-space: nowrap; }
        .tab-btn.active { background: #2e7d32; color: white; }
        .tab-content { display: none; }
        .tab-content.show { display: block; }

        /* PROFILE PAGE */
        .profile-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            width: 210mm;
            height: 297mm;
            margin-left: auto;
            margin-right: auto;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e5e5;
        }

        .avatar-wrapper {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #e8f5e9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: #2e7d32;
            object-fit: cover;
            cursor: pointer;
            border: 3px solid #2e7d32;
        }

        .avatar-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 28px;
            height: 28px;
            background: #2e7d32;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            border: 2px solid white;
        }

        #avatarInput {
            display: none;
        }

        .profile-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-item {
            text-align: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .info-label {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .info-value {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
        }

        .profile-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            line-height: 2;
        }

        .detail-field {
            margin-bottom: 15px;
        }

        .detail-field label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .detail-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-edit {
            flex: 1;
            padding: 12px;
            background: #2e7d32;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-edit:hover {
            background: #1b5e20;
        }

        .btn-cancel {
            flex: 1;
            padding: 12px;
            background: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* GRID CARDS */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .class-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border-top: 4px solid;
            cursor: pointer;
        }

        .class-card:nth-child(4n+1) { border-top-color: #2e7d32; background: linear-gradient(135deg, rgba(46,125,50,0.02) 0%, rgba(46,125,50,0.05) 100%); }
        .class-card:nth-child(4n+2) { border-top-color: #1976d2; background: linear-gradient(135deg, rgba(25,118,210,0.02) 0%, rgba(25,118,210,0.05) 100%); }
        .class-card:nth-child(4n+3) { border-top-color: #f57c00; background: linear-gradient(135deg, rgba(245,124,0,0.02) 0%, rgba(245,124,0,0.05) 100%); }
        .class-card:nth-child(4n+0) { border-top-color: #c62828; background: linear-gradient(135deg, rgba(198,40,40,0.02) 0%, rgba(198,40,40,0.05) 100%); }

        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .class-card h3 { font-size: 1.3em; margin-bottom: 8px; color: #333; }
        .class-card p { font-size: 0.9em; color: #666; margin-bottom: 15px; }

        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px 0; }
        .stat { background: #f5f5f5; padding: 12px; border-radius: 8px; text-align: center; }
        .stat strong { font-size: 1.5em; display: block; }
        .stat-label { font-size: 0.8em; color: #999; margin-top: 3px; }

        .bunk-alert { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            font-weight: 600;
            font-size: 0.95em;
            border-left: 4px solid;
        }

        .class-card:nth-child(4n+1) .bunk-alert { background: rgba(46,125,50,0.15); border-left-color: #2e7d32; color: #1b5e20; }
        .class-card:nth-child(4n+2) .bunk-alert { background: rgba(25,118,210,0.15); border-left-color: #1976d2; color: #0d47a1; }
        .class-card:nth-child(4n+3) .bunk-alert { background: rgba(245,124,0,0.15); border-left-color: #f57c00; color: #e65100; }
        .class-card:nth-child(4n+0) .bunk-alert { background: rgba(198,40,40,0.15); border-left-color: #c62828; color: #b71c1c; }

        .action-buttons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 12px 0; }
        
        .btn-small {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .class-card:nth-child(4n+1) .btn-action { background: rgba(46,125,50,0.2); color: #1b5e20; }
        .class-card:nth-child(4n+1) .btn-action:hover { background: rgba(46,125,50,0.3); }
        
        .class-card:nth-child(4n+2) .btn-action { background: rgba(25,118,210,0.2); color: #0d47a1; }
        .class-card:nth-child(4n+2) .btn-action:hover { background: rgba(25,118,210,0.3); }
        
        .class-card:nth-child(4n+3) .btn-action { background: rgba(245,124,0,0.2); color: #e65100; }
        .class-card:nth-child(4n+3) .btn-action:hover { background: rgba(245,124,0,0.3); }
        
        .class-card:nth-child(4n+0) .btn-action { background: rgba(198,40,40,0.2); color: #b71c1c; }
        .class-card:nth-child(4n+0) .btn-action:hover { background: rgba(198,40,40,0.3); }

        .empty { text-align: center; padding: 60px 20px; color: #999; background: white; border-radius: 12px; }

        .form-section { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .form-section h3 { margin-bottom: 20px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin-bottom: 12px; }

        .btn-add {
            background: #2e7d32;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            margin-right: 10px;
        }

        .btn-add:hover {
            background: #1b5e20;
        }

        .quote-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid #2e7d32;
        }

        .quote-section p {
            font-size: 1.2em;
            color: #333;
            font-style: italic;
            margin-bottom: 10px;
        }

        .quote-section span {
            color: #999;
            font-size: 0.9em;
        }

        /* FILE UPLOAD */
        .upload-container {
            background: #f5f5f5;
            border: 2px dashed #2e7d32;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-container:hover {
            background: #e8f5e9;
            border-color: #1b5e20;
        }

        .upload-container input[type="file"] {
            display: none;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .upload-text {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .upload-subtext {
            font-size: 0.9em;
            color: #999;
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .file-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.2s;
        }

        .file-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .file-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .file-name {
            font-weight: 600;
            color: #333;
            font-size: 0.85em;
            word-break: break-word;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .file-size {
            font-size: 0.75em;
            color: #999;
            margin-bottom: 10px;
        }

        .file-actions {
            display: flex;
            gap: 5px;
        }

        .file-btn-small {
            flex: 1;
            padding: 6px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.7em;
            font-weight: 600;
            transition: all 0.2s;
        }

        .file-btn-download {
            background: #2e7d32;
            color: white;
        }

        .file-btn-download:hover {
            background: #1b5e20;
        }

        .file-btn-delete {
            background: #ffebee;
            color: #c62828;
        }

        .file-btn-delete:hover {
            background: #ffcdd2;
        }

        @media (max-width: 768px) {
            .main { margin-left: 0; }
            .sidebar { position: fixed; }
            .cards-grid { grid-template-columns: 1fr; }
            .profile-card { width: 100%; height: auto; }
            .action-buttons { grid-template-columns: 1fr; }
            .file-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
            .detail-content { width: 95%; max-width: none; }
        }

        /* SIDEBAR OVERLAY FOR MOBILE */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .sidebar-overlay.show {
            display: block;
        }

        /* QUOTE SECTION IMPROVEMENTS */
        .quote-of-day {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .quote-of-day p {
            font-size: 1.1em;
            font-style: italic;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .quote-of-day span {
            font-size: 0.85em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">üìö Paglu</div>
        
        <div class="nav-section">
            <h4>Navigation</h4>
            <div class="nav-item active" onclick="switchTab(0)">üìä Overview</div>
            <div class="nav-item" onclick="switchTab(1)">üë§ Profile</div>
            <div class="nav-item" onclick="switchTab(2)">‚ûï Add Subject</div>
            <div class="nav-item" onclick="switchTab(3)">üìù Notes</div>
        </div>

        <div class="nav-section">
            <h4>Data Storage</h4>
            <div class="nav-item" onclick="switchTab(4)">‚úì Mark Att</div>
            <div class="nav-item" onclick="switchTab(5)">üìã Assign</div>
            <div class="nav-item" onclick="switchTab(6)">üìä Marks</div>
            <div class="nav-item" onclick="switchTab(7)">üìÅ Files</div>
        </div>

        <div class="nav-section">
            <h4>Subjects</h4>
            <div id="subjectList"></div>
        </div>

        <div class="sidebar-footer">
            <button onclick="clearData()">Clear All</button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main" id="main">
        <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebarOnMobile()"></div>
        <header>
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Attendance Paglu</h1>
                <div class="header-user-info" id="headerUserInfo" style="display: flex; align-items: center; gap: 10px; margin-left: 30px;">
                    <img id="headerAvatar" src="" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #2e7d32; display: none;">
                    <span id="headerUserName" style="font-size: 0.95em; font-weight: 600;"></span>
                </div>
            </div>
            <div id="headerBtn"></div>
        </header>

        <!-- SETUP MODAL -->
        <div id="setupModal" class="modal">
            <div class="modal-content">
                <h2>Set Up Your Profile</h2>
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="name" placeholder="e.g., Raj Kumar">
                </div>
                <div class="form-group">
                    <label>Roll Number</label>
                    <input type="text" id="roll" placeholder="e.g., 21BCS001">
                </div>
                <div class="form-group">
                    <label>Semester</label>
                    <select id="semester">
                        <option value="">Select</option>
                        <option value="1">1st</option>
                        <option value="2">2nd</option>
                        <option value="3">3rd</option>
                        <option value="4">4th</option>
                        <option value="5">5th</option>
                        <option value="6">6th</option>
                        <option value="7">7th</option>
                        <option value="8">8th</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Total Credits</label>
                    <input type="number" id="credits" placeholder="e.g., 24" min="1">
                </div>
                <div class="button-group">
                    <button class="btn-modal btn-primary" onclick="startTracking()">Start</button>
                    <button class="btn-modal btn-secondary" onclick="closeSetup()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- DETAIL MODAL -->
        <div id="detailModal" class="detail-modal">
            <div class="detail-content">
                <div class="detail-header">
                    <button class="close-btn" onclick="closeDetailModal()">‚úï</button>
                    <h2 id="detailTitle">Subject Name</h2>
                    <p id="detailSubtitle">Code ‚Ä¢ Faculty</p>
                </div>
                <div class="detail-body" id="detailBody"></div>
            </div>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(0)">Overview</button>
            <button class="tab-btn" onclick="switchTab(1)">Profile</button>
            <button class="tab-btn" onclick="switchTab(2)">Add Subject</button>
            <button class="tab-btn" onclick="switchTab(3)">Notes</button>
            <button class="tab-btn" onclick="switchTab(4)">Mark Att</button>
            <button class="tab-btn" onclick="switchTab(5)">Assign</button>
            <button class="tab-btn" onclick="switchTab(6)">Marks</button>
            <button class="tab-btn" onclick="switchTab(8)">Upload Files</button>
            <button class="tab-btn" onclick="switchTab(7)">My Files</button>
        </div>

        <!-- TAB 1: OVERVIEW -->
        <div id="overview" class="tab-content show">
            <div id="overviewContent"></div>
        </div>

        <!-- TAB 2: PROFILE -->
        <div id="profile" class="tab-content">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="avatar-wrapper">
                        <div class="avatar" id="avatarDisplay" onclick="document.getElementById('avatarInput').click()">üë§</div>
                        <input type="file" id="avatarInput" accept="image/*" onchange="uploadAvatar(event)">
                    </div>
                    <h2 id="profileName">Your Name</h2>
                    <p id="profileRoll" style="color: #999; margin-top: 5px;">Roll Number</p>
                </div>

                <div class="profile-info">
                    <div class="info-item">
                        <div class="info-label">Semester</div>
                        <div class="info-value" id="profileSem">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Credits</div>
                        <div class="info-value" id="profileCredits">-</div>
                    </div>
                </div>

                <div class="profile-details">
                    <div class="detail-field">
                        <label>Name</label>
                        <input type="text" id="editName" placeholder="Your Name">
                    </div>
                    <div class="detail-field">
                        <label>Roll Number</label>
                        <input type="text" id="editRoll" placeholder="Roll Number">
                    </div>
                    <div class="detail-field">
                        <label>Semester</label>
                        <select id="editSemester" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px;">
                            <option value="1">1st</option>
                            <option value="2">2nd</option>
                            <option value="3">3rd</option>
                            <option value="4">4th</option>
                            <option value="5">5th</option>
                            <option value="6">6th</option>
                            <option value="7">7th</option>
                            <option value="8">8th</option>
                        </select>
                    </div>
                    <div class="detail-field">
                        <label>Credits</label>
                        <input type="number" id="editCredits" placeholder="Total Credits">
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn-edit" onclick="saveProfileChanges()">Save Changes</button>
                    <button class="btn-cancel" onclick="resetProfileForm()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- TAB 3: ADD SUBJECT -->
        <div id="addTab" class="tab-content">
            <div class="form-section">
                <h3>Add New Subject</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Subject Name</label>
                        <input type="text" id="className" placeholder="e.g., Data Structures">
                    </div>
                    <div class="form-group">
                        <label>Course Code</label>
                        <input type="text" id="classCode" placeholder="e.g., CS101">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Faculty Name</label>
                        <input type="text" id="faculty" placeholder="e.g., Dr. Smith">
                    </div>
                    <div class="form-group">
                        <label>Total Classes</label>
                        <input type="number" id="totalClasses" placeholder="45" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Required Attendance %</label>
                        <input type="number" id="required" value="75" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label>Credits</label>
                        <input type="number" id="classCredits" value="3" min="1">
                    </div>
                </div>
                <button class="btn-add" onclick="addClass()">Add Subject</button>
            </div>
        </div>

        <!-- TAB 4: HANDWRITTEN NOTES -->
        <div id="notesTab" class="tab-content">
            <div class="form-section">
                <h3>üìù Handwritten Notes Generator</h3>
                <p style="color: #999; margin-bottom: 15px; font-size: 0.9em;">Note: Text is rendered using handwriting fonts (no API needed). All processing happens in your browser.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Note Title</label>
                        <input type="text" id="noteTitle" placeholder="e.g., Chapter 1 Notes">
                    </div>
                </div>
                <div class="form-group">
                    <label>Content</label>
                    <textarea id="noteContent" placeholder="Type your notes here..." style="height: 150px;"></textarea>
                </div>

                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4 style="margin-bottom: 15px;">Font Selection</h4>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;" id="fontSelector"></div>
                </div>

                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4 style="margin-bottom: 15px;">Customization</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Font Size</label>
                            <input type="range" id="fontSize" min="16" max="32" value="22" oninput="updatePreview()">
                        </div>
                        <div class="form-group">
                            <label>Line Height</label>
                            <input type="range" id="lineHeight" min="1.2" max="2.5" step="0.1" value="1.8" oninput="updatePreview()">
                        </div>
                    </div>
                </div>

                <button class="btn-add" onclick="generateNotes()">Generate Handwritten Notes</button>
                <button class="btn-add" id="printBtn" style="display: none; background: #1976d2;" onclick="window.print()">üñ®Ô∏è Print Notes</button>
                <div id="handwritingOutput" style="background: white; border-radius: 10px; margin-top: 20px; min-height: 300px; padding: 20px; border: 2px solid #ddd; white-space: pre-wrap; word-wrap: break-word; display: none;"></div>
            </div>
        </div>

        <!-- TAB 5: MARK ATTENDANCE -->
        <div id="markAttTab" class="tab-content">
            <div class="form-section">
                <h3>‚úì Mark Attendance</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Subject</label>
                        <select id="attSubject">
                            <option value="">Select Subject</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="attDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="attNotes" placeholder="Add any notes..." style="height: 100px;"></textarea>
                </div>
                <button class="btn-add" onclick="saveAttendance()">Save Attendance Record</button>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">Attendance Records</h3>
                <div id="attList"></div>
            </div>
        </div>

        <!-- TAB 6: ASSIGNMENTS -->
        <div id="assignTab" class="tab-content">
            <div class="form-section">
                <h3>üìã Assignments</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Subject</label>
                        <select id="assignSubject">
                            <option value="">Select Subject</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Assignment Name</label>
                        <input type="text" id="assignName" placeholder="e.g., Assignment 1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="assignDue">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="assignStatus">
                            <option value="pending">Pending</option>
                            <option value="submitted">Submitted</option>
                            <option value="graded">Graded</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Upload Files (PDF, Images)</label>
                    <div class="upload-container" onclick="document.getElementById('assignFile').click()">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Click to upload files</div>
                        <div class="upload-subtext">or drag & drop</div>
                        <input type="file" id="assignFile" multiple onchange="handleAssignmentFile(event)">
                    </div>
                </div>
                <button class="btn-add" onclick="saveAssignment()">Save Assignment</button>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">Saved Assignments</h3>
                <div id="assignList"></div>
            </div>
        </div>

        <!-- TAB 7: MARKS -->
        <div id="marksTab" class="tab-content">
            <div class="form-section">
                <h3>üìä Marks</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Subject</label>
                        <select id="marksSubject">
                            <option value="">Select Subject</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Exam Type</label>
                        <select id="examType">
                            <option value="internal">Internal</option>
                            <option value="midterm">Midterm</option>
                            <option value="final">Final</option>
                            <option value="assignment">Assignment</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Marks Obtained</label>
                        <input type="number" id="marksObtained" min="0" max="100" placeholder="e.g., 85">
                    </div>
                    <div class="form-group">
                        <label>Total Marks</label>
                        <input type="number" id="marksTotal" min="0" max="100" placeholder="e.g., 100" value="100">
                    </div>
                </div>
                <div class="form-group">
                    <label>Upload Marks Sheet (PDF, Images)</label>
                    <div class="upload-container" onclick="document.getElementById('marksFile').click()">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-text">Click to upload marks sheet</div>
                        <div class="upload-subtext">or drag & drop</div>
                        <input type="file" id="marksFile" multiple onchange="handleMarksFile(event)">
                    </div>
                </div>
                <button class="btn-add" onclick="saveMarks()">Save Marks</button>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">Marks Records</h3>
                <div id="marksList"></div>
            </div>
        </div>

        <!-- TAB 8: UPLOAD FILES -->
        <div id="uploadFilesTab" class="tab-content">
            <div class="form-section">
                <h3>üìÅ Upload Files</h3>
                <p style="color: #999; margin-bottom: 15px;">Upload your documents, notes, PDFs, images, and other files</p>
                
                <div class="form-group">
                    <label>Upload Any Files (Images, PDFs, Documents, etc.)</label>
                    <div class="upload-container" onclick="document.getElementById('generalFiles').click()">
                        <div class="upload-icon">üì¶</div>
                        <div class="upload-text">Click to upload files</div>
                        <div class="upload-subtext">Images, PDFs, Documents, Notes, any format</div>
                        <input type="file" id="generalFiles" multiple onchange="handleGeneralFiles(event)">
                    </div>
                </div>
                <button class="btn-add" onclick="confirmUpload()">Save Files</button>
            </div>
        </div>

        <!-- TAB 7: MY FILES (SAVED FILES) -->
        <div id="filesTab" class="tab-content">
            <div class="form-section">
                <h3>üìÅ My Saved Files</h3>
                <p style="color: #999; margin-bottom: 15px;">Access all your uploaded files, documents, and materials</p>
                
                <div id="filesList"></div>
            </div>
        </div>
    </div>

    <script>
        let student = null;
        let db = {
            classes: [],
            attendance: {},
            assignments: [],
            marks: {},
            notes: [],
            attendanceRecords: [],
            assignmentRecords: [],
            marksRecords: [],
            generalFiles: [],
            isLoggedIn: false
        };

        const fonts = [
            'Indie Flower', 'Caveat', 'Satisfy', 'Kalam', 'Comfortaa',
            'Gochi Hand', 'Courgette', 'Permanent Marker', 'Covered By Your Grace',
            'Fredoka One', 'Pacifico', 'Architects Daughter', 'Amatic SC',
            'Handlee', 'Nunito', 'Quicksand'
        ];

        const quotes = [
            "Knowledge is power. Keep learning!",
            "Your effort today is your success tomorrow.",
            "Excellence is not a destination; it is a continuous journey.",
            "Study hard today for a better tomorrow.",
            "Consistency is the key to success.",
            "Every master was once a beginner.",
            "Make your education count.",
            "Success is the sum of small efforts.",
            "Learning never exhausts the mind.",
            "You are capable of amazing things."
        ];

        let selectedFont = 'Indie Flower';
        let tempUploadedFiles = [];

        // INITIALIZE
        function initializeApp() {
            const saved = localStorage.getItem('student');
            const savedDb = localStorage.getItem('db');
            
            if (saved && savedDb) {
                student = JSON.parse(saved);
                db = JSON.parse(savedDb);
                db.isLoggedIn = true;
                renderProfile();
                render();
                showQuoteOfDay();
                updateHeaderUserInfo();
            } else {
                openSetup();
                document.getElementById('headerBtn').innerHTML = '<button class="new-btn" style="width: auto; padding: 10px 20px;" onclick="openSetup()">Setup</button>';
            }
            
            initializeFontSelector();
            updateSubjectSelects();
            
            // Add click outside to close sidebar
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.querySelector('.menu-toggle');
                const overlay = document.getElementById('sidebarOverlay');
                
                if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                    if (sidebar.classList.contains('closed') === false && window.innerWidth <= 768) {
                        closeSidebarOnMobile();
                    }
                }
            });
        }

        function updateHeaderUserInfo() {
            if (student && db.isLoggedIn) {
                const headerUserInfo = document.getElementById('headerUserInfo');
                const headerUserName = document.getElementById('headerUserName');
                const headerAvatar = document.getElementById('headerAvatar');
                
                headerUserName.textContent = student.name;
                
                if (student.avatar) {
                    headerAvatar.src = student.avatar;
                    headerAvatar.style.display = 'block';
                }
            }
        }

        function showQuoteOfDay() {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('headerBtn').innerHTML = `
                <div class="quote-of-day">
                    <p>"${quote}"</p>
                    <span>- Quote of the Day</span>
                </div>
            `;
        }

        function initializeFontSelector() {
            let html = '';
            fonts.forEach((font, idx) => {
                html += `<button class="btn-small ${idx === 0 ? 'active' : ''}" style="font-family: '${font}', cursive; background: ${idx === 0 ? '#2e7d32' : '#f5f5f5'}; color: ${idx === 0 ? 'white' : '#333'}; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;" onclick="selectFont('${font}', this)">${font.substring(0, 6)}</button>`;
            });
            document.getElementById('fontSelector').innerHTML = html;
        }

        function selectFont(font, el) {
            document.querySelectorAll('#fontSelector button').forEach(e => {
                e.style.background = '#f5f5f5';
                e.style.color = '#333';
            });
            el.style.background = '#2e7d32';
            el.style.color = 'white';
            selectedFont = font;
            updatePreview();
        }

        // TOGGLE SIDEBAR
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('closed');
            document.getElementById('main').classList.toggle('sidebar-closed');
            
            if (window.innerWidth <= 768) {
                document.getElementById('sidebarOverlay').classList.toggle('show');
            }
        }

        function closeSidebarOnMobile() {
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('closed');
                document.getElementById('main').classList.add('sidebar-closed');
                document.getElementById('sidebarOverlay').classList.remove('show');
            }
        }

        // SETUP
        function openSetup() {
            document.getElementById('setupModal').classList.add('show');
        }

        function closeSetup() {
            document.getElementById('setupModal').classList.remove('show');
        }

        function startTracking() {
            const name = document.getElementById('name').value.trim();
            const roll = document.getElementById('roll').value.trim();
            const semester = document.getElementById('semester').value;
            const credits = document.getElementById('credits').value;

            if (!name || !roll || !semester || !credits) {
                alert('Please fill all fields!');
                return;
            }

            student = { name, roll, semester, credits, avatar: null };
            db.isLoggedIn = true;
            closeSetup();
            
            localStorage.setItem('student', JSON.stringify(student));
            localStorage.setItem('db', JSON.stringify(db));
            
            renderProfile();
            render();
            showQuoteOfDay();
            updateHeaderUserInfo();
        }

        // PROFILE
        function uploadAvatar(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                student.avatar = e.target.result;
                localStorage.setItem('student', JSON.stringify(student));
                renderProfile();
            };
            reader.readAsDataURL(file);
        }

        function renderProfile() {
            if (!student) return;

            document.getElementById('profileName').textContent = student.name;
            document.getElementById('profileRoll').textContent = student.roll;
            document.getElementById('profileSem').textContent = student.semester;
            document.getElementById('profileCredits').textContent = student.credits;

            if (student.avatar) {
                const img = document.getElementById('avatarDisplay');
                img.style.backgroundImage = `url(${student.avatar})`;
                img.style.backgroundSize = 'cover';
                img.textContent = '';
            }

            document.getElementById('editName').value = student.name;
            document.getElementById('editRoll').value = student.roll;
            document.getElementById('editSemester').value = student.semester;
            document.getElementById('editCredits').value = student.credits;
        }

        function saveProfileChanges() {
            const name = document.getElementById('editName').value.trim();
            const roll = document.getElementById('editRoll').value.trim();
            const semester = document.getElementById('editSemester').value;
            const credits = document.getElementById('editCredits').value.trim();

            if (!name || !roll || !semester || !credits) {
                alert('Please fill all fields!');
                return;
            }

            student.name = name;
            student.roll = roll;
            student.semester = semester;
            student.credits = credits;

            localStorage.setItem('student', JSON.stringify(student));
            renderProfile();
            render();
            updateHeaderUserInfo();
            alert('Profile updated successfully!');
        }

        function resetProfileForm() {
            renderProfile();
        }

        // TAB SWITCHING
        function switchTab(index) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            const tabs = ['overview', 'profile', 'addTab', 'notesTab', 'markAttTab', 'assignTab', 'marksTab', 'filesTab', 'uploadFilesTab'];
            document.getElementById(tabs[index]).classList.add('show');
            document.querySelectorAll('.tab-btn')[index].classList.add('active');

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item')[index] && document.querySelectorAll('.nav-item')[index].classList.add('active');
            
            if (index >= 4) {
                updateSubjectSelects();
                if (index === 4) renderAttendanceRecords();
                if (index === 5) renderAssignmentRecords();
                if (index === 6) renderMarksRecords();
                if (index === 7) renderGeneralFiles();
                if (index === 8) tempUploadedFiles = [];
            }
            
            closeSidebarOnMobile();
        }

        function updateSubjectSelects() {
            let html = '<option value="">Select Subject</option>';
            db.classes.forEach(cls => {
                html += `<option value="${cls.id}">${cls.name}</option>`;
            });
            document.getElementById('attSubject').innerHTML = html;
            document.getElementById('assignSubject').innerHTML = html;
            document.getElementById('marksSubject').innerHTML = html;
        }

        // ADD SUBJECT
        function addClass() {
            const name = document.getElementById('className').value.trim();
            const code = document.getElementById('classCode').value.trim();
            const faculty = document.getElementById('faculty').value.trim();
            const total = parseInt(document.getElementById('totalClasses').value);
            const required = parseInt(document.getElementById('required').value);
            const credits = parseInt(document.getElementById('classCredits').value);

            if (!name || !code || !faculty || !total) {
                alert('Please fill all fields!');
                return;
            }

            const classId = Date.now();
            db.classes.push({ id: classId, name, code, faculty, total, required, credits });
            db.attendance[classId] = { present: 0, absent: 0 };

            document.getElementById('className').value = '';
            document.getElementById('classCode').value = '';
            document.getElementById('faculty').value = '';
            document.getElementById('totalClasses').value = '';
            document.getElementById('required').value = '75';
            document.getElementById('classCredits').value = '3';

            localStorage.setItem('db', JSON.stringify(db));
            render();
            updateSubjectSelects();
            alert('Subject added!');
        }

        // ATTENDANCE RECORD
        function saveAttendance() {
            const subjectId = document.getElementById('attSubject').value;
            const date = document.getElementById('attDate').value;
            const notes = document.getElementById('attNotes').value.trim();

            if (!subjectId || !date) {
                alert('Please select subject and date!');
                return;
            }

            const subject = db.classes.find(c => c.id == subjectId);
            db.attendanceRecords.push({
                id: Date.now(),
                subjectId,
                subjectName: subject.name,
                date,
                notes,
                savedDate: new Date().toLocaleDateString()
            });

            document.getElementById('attSubject').value = '';
            document.getElementById('attDate').value = '';
            document.getElementById('attNotes').value = '';

            localStorage.setItem('db', JSON.stringify(db));
            renderAttendanceRecords();
            alert('Attendance record saved!');
        }

        function renderAttendanceRecords() {
            if (db.attendanceRecords.length === 0) {
                document.getElementById('attList').innerHTML = '<p style="color: #999;">No records yet</p>';
                return;
            }

            let html = '<div class="file-grid">';
            db.attendanceRecords.forEach(rec => {
                html += `
                    <div class="file-card">
                        <div class="file-icon">üìÖ</div>
                        <div class="file-name">${rec.subjectName}</div>
                        <div class="file-size">${rec.date}</div>
                        <div class="file-actions">
                            <button class="file-btn-small file-btn-delete" onclick="deleteAttendanceRecord(${rec.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('attList').innerHTML = html;
        }

        function deleteAttendanceRecord(id) {
            if (!confirm('Delete this record?')) return;
            db.attendanceRecords = db.attendanceRecords.filter(r => r.id !== id);
            localStorage.setItem('db', JSON.stringify(db));
            renderAttendanceRecords();
        }

        // ASSIGNMENT RECORDS
        function handleAssignmentFile(event) {
            const files = event.target.files;
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (!window.assignmentFiles) window.assignmentFiles = [];
                    window.assignmentFiles.push({
                        data: e.target.result,
                        name: file.name,
                        size: file.size
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        function saveAssignment() {
            const subjectId = document.getElementById('assignSubject').value;
            const name = document.getElementById('assignName').value.trim();
            const due = document.getElementById('assignDue').value;
            const status = document.getElementById('assignStatus').value;

            if (!subjectId || !name || !due) {
                alert('Please fill required fields!');
                return;
            }

            const subject = db.classes.find(c => c.id == subjectId);
            const files = window.assignmentFiles || [];
            
            db.assignmentRecords.push({
                id: Date.now(),
                subjectId,
                subjectName: subject.name,
                name,
                due,
                status,
                files: files,
                savedDate: new Date().toLocaleDateString()
            });

            document.getElementById('assignSubject').value = '';
            document.getElementById('assignName').value = '';
            document.getElementById('assignDue').value = '';
            document.getElementById('assignStatus').value = 'pending';
            document.getElementById('assignFile').value = '';
            window.assignmentFiles = [];

            localStorage.setItem('db', JSON.stringify(db));
            renderAssignmentRecords();
            alert('Assignment saved!');
        }

        function renderAssignmentRecords() {
            if (db.assignmentRecords.length === 0) {
                document.getElementById('assignList').innerHTML = '<p style="color: #999;">No assignments yet</p>';
                return;
            }

            let html = '<div class="file-grid">';
            db.assignmentRecords.forEach(rec => {
                html += `
                    <div class="file-card">
                        <div class="file-icon">üìã</div>
                        <div class="file-name">${rec.name}</div>
                        <div class="file-size">Due: ${rec.due}</div>
                        <div class="file-actions">
                            ${rec.files.length > 0 ? `<button class="file-btn-small file-btn-download" onclick="downloadAssignmentFiles(${rec.id})">Files</button>` : ''}
                            <button class="file-btn-small file-btn-delete" onclick="deleteAssignmentRecord(${rec.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('assignList').innerHTML = html;
        }

        function downloadAssignmentFiles(id) {
            const rec = db.assignmentRecords.find(r => r.id === id);
            if (!rec || rec.files.length === 0) return;
            
            rec.files.forEach(file => {
                const link = document.createElement('a');
                link.href = file.data;
                link.download = file.name;
                link.click();
            });
        }

        function deleteAssignmentRecord(id) {
            if (!confirm('Delete this assignment?')) return;
            db.assignmentRecords = db.assignmentRecords.filter(r => r.id !== id);
            localStorage.setItem('db', JSON.stringify(db));
            renderAssignmentRecords();
        }

        // MARKS RECORDS
        function handleMarksFile(event) {
            const files = event.target.files;
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (!window.marksFiles) window.marksFiles = [];
                    window.marksFiles.push({
                        data: e.target.result,
                        name: file.name,
                        size: file.size
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        function saveMarks() {
            const subjectId = document.getElementById('marksSubject').value;
            const examType = document.getElementById('examType').value;
            const obtained = parseInt(document.getElementById('marksObtained').value);
            const total = parseInt(document.getElementById('marksTotal').value);

            if (!subjectId || obtained === '' || total === '') {
                alert('Please fill all fields!');
                return;
            }

            const subject = db.classes.find(c => c.id == subjectId);
            const percentage = ((obtained / total) * 100).toFixed(1);
            const files = window.marksFiles || [];

            db.marksRecords.push({
                id: Date.now(),
                subjectId,
                subjectName: subject.name,
                examType,
                obtained,
                total,
                percentage,
                files: files,
                savedDate: new Date().toLocaleDateString()
            });

            document.getElementById('marksSubject').value = '';
            document.getElementById('examType').value = 'internal';
            document.getElementById('marksObtained').value = '';
            document.getElementById('marksTotal').value = '100';
            document.getElementById('marksFile').value = '';
            window.marksFiles = [];

            localStorage.setItem('db', JSON.stringify(db));
            renderMarksRecords();
            alert('Marks saved!');
        }

        function renderMarksRecords() {
            if (db.marksRecords.length === 0) {
                document.getElementById('marksList').innerHTML = '<p style="color: #999;">No marks records yet</p>';
                return;
            }

            let html = '<div class="file-grid">';
            db.marksRecords.forEach(rec => {
                html += `
                    <div class="file-card">
                        <div class="file-icon">üìä</div>
                        <div class="file-name">${rec.subjectName}</div>
                        <div class="file-size">${rec.obtained}/${rec.total} (${rec.percentage}%)</div>
                        <div class="file-actions">
                            ${rec.files.length > 0 ? `<button class="file-btn-small file-btn-download" onclick="downloadMarksFiles(${rec.id})">View</button>` : ''}
                            <button class="file-btn-small file-btn-delete" onclick="deleteMarksRecord(${rec.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('marksList').innerHTML = html;
        }

        function downloadMarksFiles(id) {
            const rec = db.marksRecords.find(r => r.id === id);
            if (!rec || rec.files.length === 0) return;
            
            rec.files.forEach(file => {
                const link = document.createElement('a');
                link.href = file.data;
                link.download = file.name;
                link.click();
            });
        }

        function deleteMarksRecord(id) {
            if (!confirm('Delete this marks record?')) return;
            db.marksRecords = db.marksRecords.filter(r => r.id !== id);
            localStorage.setItem('db', JSON.stringify(db));
            renderMarksRecords();
        }

        // GENERAL FILE STORAGE - TEMP UPLOAD
        function handleGeneralFiles(event) {
            const files = event.target.files;
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    tempUploadedFiles.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        size: file.size,
                        data: e.target.result,
                        type: file.type
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        function confirmUpload() {
            if (tempUploadedFiles.length === 0) {
                alert('Please select files to upload!');
                return;
            }

            tempUploadedFiles.forEach(file => {
                db.generalFiles.push({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    data: file.data,
                    type: file.type,
                    uploadDate: new Date().toLocaleDateString()
                });
            });

            tempUploadedFiles = [];
            document.getElementById('generalFiles').value = '';
            localStorage.setItem('db', JSON.stringify(db));
            alert('Files uploaded successfully!');
            switchTab(7);
                };
                reader.readAsDataURL(file);
            });
        }

        function renderGeneralFiles() {
            if (db.generalFiles.length === 0) {
                document.getElementById('filesList').innerHTML = '<p style="color: #999;">No files uploaded yet</p>';
                return;
            }

            let html = '<div class="file-grid">';
            db.generalFiles.forEach(file => {
                const sizeKB = (file.size / 1024).toFixed(1);
                const icon = file.type.includes('image') ? 'üñºÔ∏è' : file.type.includes('pdf') ? 'üìÑ' : 'üìÅ';
                
                html += `
                    <div class="file-card">
                        <div class="file-icon">${icon}</div>
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${sizeKB} KB</div>
                        <div class="file-actions">
                            <button class="file-btn-small file-btn-download" onclick="downloadGeneralFile(${file.id})">Download</button>
                            <button class="file-btn-small file-btn-delete" onclick="deleteGeneralFile(${file.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('filesList').innerHTML = html;
        }

        function downloadGeneralFile(id) {
            const file = db.generalFiles.find(f => f.id === id);
            if (!file) return;
            
            const link = document.createElement('a');
            link.href = file.data;
            link.download = file.name;
            link.click();
        }

        function deleteGeneralFile(id) {
            if (!confirm('Delete this file?')) return;
            db.generalFiles = db.generalFiles.filter(f => f.id !== id);
            localStorage.setItem('db', JSON.stringify(db));
            renderGeneralFiles();
        }

        // HANDWRITTEN NOTES
        function generateNotes() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();

            if (!title || !content) {
                alert('Please fill in title and content!');
                return;
            }

            const output = document.getElementById('handwritingOutput');
            updatePreview();
            output.style.display = 'block';

            db.notes.push({
                id: Date.now(),
                title,
                content,
                font: selectedFont,
                date: new Date().toLocaleDateString()
            });

            localStorage.setItem('db', JSON.stringify(db));
            document.getElementById('printBtn').style.display = 'inline-block';
        }

        function updatePreview() {
            const content = document.getElementById('noteContent').value;
            const title = document.getElementById('noteTitle').value;
            const fontSize = document.getElementById('fontSize').value;
            const lineHeight = document.getElementById('lineHeight').value;

            const output = document.getElementById('handwritingOutput');
            output.style.fontFamily = `'${selectedFont}', cursive`;
            output.style.fontSize = fontSize + 'px';
            output.style.lineHeight = lineHeight;
            output.style.padding = '40px 60px';
            output.style.backgroundImage = 'repeating-linear-gradient(transparent, transparent ' + (lineHeight * fontSize - fontSize) + 'px, #e0e0e0 ' + (lineHeight * fontSize - fontSize) + 'px, #e0e0e0 ' + (lineHeight * fontSize - fontSize + 1) + 'px)';
            output.style.backgroundPosition = '0 20px';
            output.style.marginLeft = '30px';
            output.style.borderLeft = '3px solid #2e7d32';
            
            let styledContent = content.split('\n').map(line => `<p style="margin: 0;">${line || ' '}</p>`).join('');
            output.innerHTML = `<h3 style="margin-bottom: 20px;">${title}</h3>${styledContent}`;
        }

        // DETAIL MODAL
        function viewSubjectDetails(classId) {
            const cls = db.classes.find(c => c.id === classId);
            if (!cls) return;

            const att = db.attendance[cls.id] || { present: 0, absent: 0 };
            const total = att.present + att.absent;
            const pct = total > 0 ? ((att.present / total) * 100).toFixed(1) : 0;
            const requiredClasses = Math.ceil((cls.total * cls.required) / 100);
            const bunk = Math.max(0, requiredClasses - att.present);

            document.getElementById('detailTitle').textContent = cls.name;
            document.getElementById('detailSubtitle').textContent = cls.code + ' ‚Ä¢ ' + cls.faculty;

            let html = `
                <div class="detail-section">
                    <h3>Class Information</h3>
                    <div class="detail-stat-grid">
                        <div class="detail-stat">
                            <label>Total Classes</label>
                            <value>${cls.total}</value>
                        </div>
                        <div class="detail-stat">
                            <label>Credits</label>
                            <value>${cls.credits}</value>
                        </div>
                        <div class="detail-stat">
                            <label>Faculty</label>
                            <value>${cls.faculty}</value>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Attendance Status</h3>
                    <div class="detail-stat-grid">
                        <div class="detail-stat">
                            <label>Current Attendance</label>
                            <value style="color: #2e7d32;">${pct}%</value>
                        </div>
                        <div class="detail-stat">
                            <label>Classes Attended</label>
                            <value style="color: #1976d2;">${att.present}/${total}</value>
                        </div>
                        <div class="detail-stat">
                            <label>Can Skip</label>
                            <value style="color: #f57c00;">${bunk}</value>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Quick Actions</h3>
                    <div class="detail-actions">
                        <button class="detail-btn secondary" onclick="quickMark(${classId}, 'present'); closeDetailModal();">‚úì Present</button>
                        <button class="detail-btn secondary" onclick="quickMark(${classId}, 'absent'); closeDetailModal();">‚úó Absent</button>
                        <button class="detail-btn secondary" onclick="switchTab(4); closeDetailModal();">Mark Att</button>
                        <button class="detail-btn danger" onclick="deleteClass(${classId}); closeDetailModal();">Delete</button>
                    </div>
                </div>
            `;

            document.getElementById('detailBody').innerHTML = html;
            document.getElementById('detailModal').classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        // CLEAR DATA
        function clearData() {
            if (!confirm('Are you sure? This will delete all data!')) return;
            
            student = null;
            db = { classes: [], attendance: {}, assignments: [], marks: {}, notes: [], attendanceRecords: [], assignmentRecords: [], marksRecords: [], generalFiles: [] };
            localStorage.clear();
            location.reload();
        }

        // RENDER FUNCTIONS
        function render() {
            renderOverview();
            renderSidebar();
        }

        function renderOverview() {
            let html = '';

            if (db.classes.length === 0) {
                html = '<div class="empty">No subjects added yet. Click "Add Subject" to add one!</div>';
            } else {
                html = '<div class="cards-grid">';
                
                db.classes.forEach((cls, idx) => {
                    const att = db.attendance[cls.id] || { present: 0, absent: 0 };
                    const total = att.present + att.absent;
                    const pct = total > 0 ? ((att.present / total) * 100).toFixed(1) : 0;
                    const requiredClasses = Math.ceil((cls.total * cls.required) / 100);
                    const bunk = Math.max(0, requiredClasses - att.present);
                    const msg = bunk > 0 ? `You can skip ${bunk} more classes` : `You're at critical attendance`;

                    html += `
                        <div class="class-card" onclick="viewSubjectDetails(${cls.id})">
                            <h3>${cls.name}</h3>
                            <p><strong>${cls.code}</strong> ‚Ä¢ ${cls.faculty}</p>
                            <div class="stats">
                                <div class="stat"><strong>${pct}%</strong><span class="stat-label">Attendance</span></div>
                                <div class="stat"><strong>${bunk}</strong><span class="stat-label">Can Skip</span></div>
                            </div>
                            <div class="bunk-alert ${bunk > 0 ? '' : 'warning'}">${msg}</div>
                            <div class="action-buttons">
                                <button class="btn-small btn-action" onclick="event.stopPropagation(); quickMark(${cls.id}, 'present')">‚úì Present</button>
                                <button class="btn-small btn-action" onclick="event.stopPropagation(); quickMark(${cls.id}, 'absent')">‚úó Absent</button>
                                <button class="btn-small btn-action" onclick="event.stopPropagation(); viewSubjectDetails(${cls.id})">View</button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }

            document.getElementById('overviewContent').innerHTML = html;
        }

        function renderSidebar() {
            let html = '';
            
            if (db.classes.length === 0) {
                html = '<p style="color: #999; font-size: 0.85em; padding: 8px;">No subjects yet</p>';
            } else {
                db.classes.slice(0, 5).forEach((cls) => {
                    const att = db.attendance[cls.id] || { present: 0, absent: 0 };
                    const total = att.present + att.absent;
                    const pct = total > 0 ? ((att.present / total) * 100).toFixed(0) : 0;
                    
                    html += `
                        <div class="nav-item" style="text-align: left; cursor: pointer;" onclick="viewSubjectDetails(${cls.id})">
                            <strong style="font-size: 0.9em;">${cls.name}</strong><br>
                            <span style="color: #999; font-size: 0.8em;">${pct}% ‚Ä¢ ${cls.code}</span>
                        </div>
                    `;
                });
            }
            
            document.getElementById('subjectList').innerHTML = html;
        }

        function quickMark(classId, status) {
            if (status === 'present') db.attendance[classId].present++;
            else db.attendance[classId].absent++;
            localStorage.setItem('db', JSON.stringify(db));
            render();
        }

        function deleteClass(classId) {
            if (!confirm('Delete this subject?')) return;
            db.classes = db.classes.filter(c => c.id !== classId);
            delete db.attendance[classId];
            delete db.marks[classId];
            db.assignments = db.assignments.filter(a => a.classId !== classId);
            localStorage.setItem('db', JSON.stringify(db));
            render();
        }

        // Initialize on DOM load
        document.addEventListener("DOMContentLoaded", function () {
            initializeApp();
        });
    </script>
</body>
</html>
